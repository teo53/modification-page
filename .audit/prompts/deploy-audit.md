# 배포 전 감사 프롬프트

프로덕션 배포 직전 최종 점검.
가장 포괄적이고 엄격한 감사.

---

## 사용 시점

- `vercel --prod` 또는 실제 배포 직전
- 새 버전 릴리스 전
- 중요한 기능 런칭 전

---

## 프롬프트 (복사해서 Claude Code에 붙여넣기)

```
배포 전 최종 감사해줘.
프로덕션에 올라가면 실제 사용자가 쓰고, 해커도 노릴 수 있음.
나는 비개발자라서 코드 판단 못함. 확실하게 점검해줘.

## 감사 범위: 전체 프로젝트

### Phase 1: 보안 감사 (CRITICAL)

#### 1.1 인증/인가
- [ ] 모든 보호된 API에 인증 체크 있는가?
- [ ] JWT 토큰 검증 로직이 안전한가?
- [ ] 세션 만료 처리가 되어있는가?
- [ ] 비밀번호 해싱되어 저장되는가?
- [ ] OAuth 콜백이 안전한가?

#### 1.2 입력 검증
- [ ] 모든 사용자 입력이 검증되는가?
- [ ] SQL Injection 방어되는가?
- [ ] XSS 방어되는가?
- [ ] Path Traversal 방어되는가?
- [ ] 파일 업로드 검증되는가?

#### 1.3 민감정보
- [ ] API Key가 코드에 없는가?
- [ ] 비밀번호가 하드코딩 안 되어있는가?
- [ ] .env 파일이 .gitignore에 있는가?
- [ ] 에러 메시지에 민감정보 없는가?
- [ ] 로그에 민감정보 안 찍히는가?

#### 1.4 API 보안
- [ ] CORS 설정이 적절한가?
- [ ] Rate Limiting 있는가?
- [ ] 요청 크기 제한 있는가?

### Phase 2: 기능 검증 (HIGH)

#### 2.1 API 완전성
- [ ] 모든 프론트엔드 API 호출에 대응하는 엔드포인트 있는가?
- [ ] HTTP 메서드가 일치하는가? (GET/POST/PUT/DELETE)
- [ ] 요청/응답 타입이 일치하는가?
- [ ] 에러 응답 형식이 일관적인가?

#### 2.2 데이터 흐름
- [ ] 폼 제출 → API → DB 저장 완전한가?
- [ ] 데이터 조회 → API → 화면 표시 완전한가?
- [ ] 수정/삭제 로직이 완전한가?

#### 2.3 에러 처리
- [ ] 네트워크 오류 처리되는가?
- [ ] 서버 오류 처리되는가?
- [ ] 사용자에게 친절한 메시지 보여주는가?
- [ ] 에러 시 앱이 죽지 않는가?

### Phase 3: 배포 준비 (HIGH)

#### 3.1 빌드
- [ ] `npm run build` 성공하는가?
- [ ] TypeScript 에러 없는가?
- [ ] ESLint 경고 없는가?

#### 3.2 환경변수
- [ ] 프로덕션 환경변수 모두 설정되었는가?
- [ ] .env.example이 최신인가?
- [ ] 환경변수 누락으로 런타임 에러 가능성?

#### 3.3 데이터베이스
- [ ] 마이그레이션 적용되었는가?
- [ ] RLS 정책 설정되었는가?
- [ ] 인덱스 필요한 곳에 있는가?

### Phase 4: 품질 (MEDIUM)

#### 4.1 성능
- [ ] 불필요한 API 호출 없는가?
- [ ] 큰 데이터 페이지네이션 되는가?
- [ ] 이미지 최적화 되었는가?

#### 4.2 UX
- [ ] 로딩 상태 표시되는가?
- [ ] 에러 상태 표시되는가?
- [ ] 빈 상태 처리되는가?

#### 4.3 코드 정리
- [ ] console.log 제거되었는가?
- [ ] 주석 처리된 코드 제거되었는가?
- [ ] TODO 해결되었는가?

## 요청사항

1. **무조건 빌드 테스트**: `npm run build` 실행해서 성공하는지 확인

2. **CRITICAL 하나라도 있으면**: 배포 차단 권고

3. **모든 문제 직접 수정**: 발견한 건 다 고쳐줘

4. **배포 체크리스트 생성**: 내가 확인해야 할 것 정리

5. **최종 판정**: 배포 OK / 배포 보류 / 배포 금지

결과를 이 형식으로:

---

## 🚀 배포 전 최종 감사 리포트

**프로젝트**: [프로젝트명]
**감사일**: [날짜]
**목표 환경**: Production

---

### 🎯 최종 판정

# [배포 OK ✅ / 배포 보류 ⚠️ / 배포 금지 ❌]

**이유**: [한 줄 요약]

---

### 📊 Phase별 결과

| Phase | 항목 | 상태 | 이슈 |
|-------|------|------|------|
| 1. 보안 | 인증/인가 | ✅/⚠️/❌ | [숫자] |
| 1. 보안 | 입력 검증 | ✅/⚠️/❌ | [숫자] |
| 1. 보안 | 민감정보 | ✅/⚠️/❌ | [숫자] |
| 1. 보안 | API 보안 | ✅/⚠️/❌ | [숫자] |
| 2. 기능 | API 완전성 | ✅/⚠️/❌ | [숫자] |
| 2. 기능 | 데이터 흐름 | ✅/⚠️/❌ | [숫자] |
| 2. 기능 | 에러 처리 | ✅/⚠️/❌ | [숫자] |
| 3. 배포 | 빌드 | ✅/⚠️/❌ | [숫자] |
| 3. 배포 | 환경변수 | ✅/⚠️/❌ | [숫자] |
| 3. 배포 | 데이터베이스 | ✅/⚠️/❌ | [숫자] |
| 4. 품질 | 성능 | ✅/⚠️/❌ | [숫자] |
| 4. 품질 | UX | ✅/⚠️/❌ | [숫자] |
| 4. 품질 | 코드 정리 | ✅/⚠️/❌ | [숫자] |

---

### 🚨 CRITICAL (배포 전 필수 수정)

#### 1. [이슈명]
- **파일**: [경로:라인]
- **위험**: [쉬운 설명]
- **수정**: ✅ 완료 (변경 내용 설명)

---

### ⚠️ HIGH (강력 권장)

#### 1. [이슈명]
- **파일**: [경로]
- **영향**: [설명]
- **수정**: ✅ 완료 / ❌ 수동 필요

---

### 📝 MEDIUM (권장)

- [이슈 목록]

---

### ✅ 확인된 안전 항목

- [x] JWT 인증 정상
- [x] SQL Injection 방어됨
- [x] ...

---

### 📋 배포 전 체크리스트

배포 전에 직접 확인하세요:

#### 환경변수 (Vercel/서버에서)
- [ ] `DATABASE_URL` 설정됨
- [ ] `NEXTAUTH_SECRET` 설정됨
- [ ] `NEXT_PUBLIC_SUPABASE_URL` 설정됨
- [ ] [기타 필요한 변수들]

#### 브라우저 테스트
- [ ] 회원가입 → 성공하는가?
- [ ] 로그인 → 성공하는가?
- [ ] 로그아웃 → 성공하는가?
- [ ] 주요 기능 1 → 작동하는가?
- [ ] 주요 기능 2 → 작동하는가?
- [ ] 모바일에서 → 작동하는가?

#### 에러 시나리오
- [ ] 잘못된 비밀번호 → 적절한 메시지?
- [ ] 네트워크 끊김 → 앱이 안 죽는가?
- [ ] 권한 없는 접근 → 차단되는가?

---

### 🔧 수정 요약

| 파일 | 수정 내용 | 이유 |
|------|----------|------|
| [파일1] | [내용] | [이유] |
| [파일2] | [내용] | [이유] |

---

### 💡 배포 후 모니터링

배포 후 24시간 동안 확인:
1. 에러 로그 확인
2. 사용자 피드백 확인
3. 성능 지표 확인

---
```

---

## 판정 기준

| 판정 | 조건 |
|------|------|
| **배포 OK** ✅ | CRITICAL 0개, HIGH 2개 이하 |
| **배포 보류** ⚠️ | CRITICAL 0개, HIGH 3개 이상 |
| **배포 금지** ❌ | CRITICAL 1개 이상 |

---

## 배포 금지 사유 예시

- SQL Injection 취약점 존재
- API Key 하드코딩
- 인증 없이 접근 가능한 보호 API
- 빌드 실패
- 필수 환경변수 누락
