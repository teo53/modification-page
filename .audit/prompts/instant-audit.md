# 즉시 감사 프롬프트

CRITICAL 또는 HIGH 파일 수정 후 Claude Code에서 사용하는 프롬프트.

---

## 사용 시점

- `pages/api/auth/**` 파일 수정 후
- `pages/api/payment/**` 파일 수정 후
- `lib/db/**` 파일 수정 후
- `middleware.ts` 수정 후
- 기타 인증/보안/DB 관련 파일 수정 후

---

## 프롬프트 (복사해서 Claude Code에 붙여넣기)

```
방금 수정한 파일 보안 감사해줘.
나는 비개발자라서 코드 판단 못함.

## 감사 대상 파일
[여기에 파일 경로 입력, 예: pages/api/auth/login.ts]

## 체크리스트

### 1. 보안 취약점 (CRITICAL)
- [ ] SQL Injection: 사용자 입력이 쿼리에 직접 들어가는가?
- [ ] XSS: 사용자 입력이 그대로 출력되는가?
- [ ] 인증 우회: 토큰 검증을 건너뛸 수 있는가?
- [ ] 인가 우회: 다른 사용자 데이터에 접근 가능한가?
- [ ] 민감정보 노출: API key, password가 코드에 있는가?
- [ ] Rate Limiting: 무한 요청이 가능한가?

### 2. 데이터 검증 (HIGH)
- [ ] 입력 검증: 필수 필드, 타입, 범위 체크하는가?
- [ ] 출력 검증: 응답에 불필요한 정보 포함되는가?
- [ ] 에러 처리: 예외 상황에서 안전하게 실패하는가?

### 3. 로직 오류 (HIGH)
- [ ] 엣지 케이스: null, undefined, 빈 배열 처리하는가?
- [ ] 동시성: 여러 요청이 동시에 오면 문제되는가?
- [ ] 트랜잭션: DB 작업 중간에 실패하면 롤백되는가?

## 요청사항

1. **문제 발견 시**: 직접 수정해줘. 수정 전/후 코드 보여주고 왜 바꿨는지 설명해줘.

2. **설명 방식**: 
   - "해커가 이렇게 공격할 수 있어서 위험" 처럼 구체적으로
   - 개발 용어 쓰지 말고 쉬운 말로

3. **테스트 가이드**: 
   - 내가 브라우저에서 뭘 테스트해야 하는지
   - 어떤 입력을 넣어봐야 하는지

결과를 이 형식으로:

### 🔍 감사 결과

**파일**: [파일명]
**위험도**: CRITICAL / HIGH / MEDIUM / LOW

### ❌ 발견된 문제 (있으면)

#### 문제 1: [문제명]
- **위험**: [왜 위험한지 쉬운 말로]
- **수정 전**: [코드]
- **수정 후**: [코드]
- **설명**: [뭘 바꿨는지]

### ✅ 확인된 안전 항목

- [x] SQL Injection 방어됨
- [x] 인증 검증 있음
- ...

### 🧪 테스트 가이드

1. [테스트 방법 1]
2. [테스트 방법 2]
```

---

## 예시

### 입력
```
방금 수정한 파일 보안 감사해줘.
나는 비개발자라서 코드 판단 못함.

## 감사 대상 파일
pages/api/auth/login.ts

[위 체크리스트와 요청사항 그대로]
```

### 기대 출력
```
### 🔍 감사 결과

**파일**: pages/api/auth/login.ts
**위험도**: HIGH (1개 문제 발견)

### ❌ 발견된 문제

#### 문제 1: 비밀번호 평문 비교
- **위험**: 비밀번호를 그대로 비교하면 DB 유출 시 모든 계정이 털림
- **수정 전**: 
  ```typescript
  if (user.password === password) { ... }
  ```
- **수정 후**: 
  ```typescript
  import bcrypt from 'bcrypt';
  if (await bcrypt.compare(password, user.password)) { ... }
  ```
- **설명**: bcrypt로 해시된 비밀번호와 비교하도록 변경. 이제 DB가 털려도 비밀번호는 안전.

### ✅ 확인된 안전 항목

- [x] SQL Injection: Supabase 쿼리 빌더 사용 (안전)
- [x] 인증 토큰: JWT 정상 발급
- [x] Rate Limiting: middleware에서 처리됨

### 🧪 테스트 가이드

1. **정상 로그인**: 올바른 이메일/비밀번호로 로그인 → 성공해야 함
2. **틀린 비밀번호**: 잘못된 비밀번호 → "비밀번호가 틀렸습니다" 메시지
3. **없는 계정**: 존재하지 않는 이메일 → "계정을 찾을 수 없습니다" 메시지
4. **빈 입력**: 이메일이나 비밀번호 비우고 시도 → 오류 메시지
```
